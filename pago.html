<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enviar Plata</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Fuente Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">



    <!-- SF Pro Display: Números geométricos modernos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Nunito Sans: Números redondos y geométricos -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Work Sans: Números geométricos limpios -->
    <link
        href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Outfit: Números geométricos modernos -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <!-- Roboto base -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
        rel="stylesheet" />
    <!-- Hoja de estilo css -->
     <link rel="stylesheet" href="./css/pago.css">
</head>

<!-- Modal de confirmacion del encio del pago -->
 <!-- ####################################################### -->
<div id="modalConfirmacion"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:end; transition: opacity 0.3s ease;">

    <div
        style="background:#fff; border-radius:20px 20px 0 0; padding:20px; width:100%; max-width:500px; box-shadow:0 -2px 10px rgba(0,0,0,0.1);">
        <div style="text-align:right;">
            <button onclick="cerrarModal()" style="border:none; color: #433545; background:none;     font-size: 36px;
    font-weight: 300">&times;</button>
        </div>
        <h2 style="margin-top:0;">Confirma el número</h2>
        <p style="color:#e6007e;">Vas a enviar a:</p>
        <div id="nombrePersona" style="font-weight:300; font-size:18px;color: #240d25;">---</div>
        <p style="color:#e6007e; margin-top:10px;">Al número de celular:</p>
        <div id="celModal" style="font-weight:300; font-size:18px;color: #240d25;"></div>
        <p style="color:#e6007e; margin-top:10px;">¿Cuánto?</p>
        <div id="montoModal" style="font-weight:300; font-size:18px;color: #240d25;"></div>
        <h5 style="margin-top:10px;">La plata saldrá de:</h5>
        <div
            style="display:flex;  align-items:center; gap:10px; background:#fafafa; padding:10px; border-radius:5px;     border: solid 1px #ececec;">
            <img src="./ico/image.png" style="width: 47px;" />
            <div>Disponible</div>
        </div>
        <button onclick="confirmarEnvio()"
            style="width:100%; margin-top:20px; padding:14px; background:#ec008c; color:white; border:none; border-radius:5px;">Confirma</button>
        <button onclick="cerrarModal()"
            style="width:100%; margin-top:10px; padding:14px; background:white; border:1px solid #433545; border-radius:5px;">Corrige
            algo</button>
    </div>
    
</div>
<!-- ####################################################### -->
<div id="modalNuevoContacto"
    style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#fff; border-radius:10px; padding:20px; width:90%; max-width:400px;">
        <h2>Nuevo contacto</h2>
        <input type="tel" id="nuevoCel" placeholder="Número (10 dígitos)"
            style="width:100%; margin-bottom:10px; padding:10px;" />
        <input type="text" id="nuevoNombre" placeholder="Nombre real"
            style="width:100%; margin-bottom:10px; padding:10px;" />
        <input type="text" id="nuevoEnmascarado" placeholder="Nombre enmascarado"
            style="width:100%; margin-bottom:10px; padding:10px;" />
        <button onclick="confirmarNuevoContacto()"
            style="width:100%; background:#ec008c; color:white; padding:10px; border:none; border-radius:5px;">Guardar</button>
        <button onclick="cerrarModalContacto()"
            style="width:100%; background:#ccc; margin-top:10px; padding:10px; border:none; border-radius:5px;">Cancelar</button>
    </div>
</div>


<body>

    <!-- Flecha volver -->
    <div class="volver">
        <a href="#" onclick="window.history.back()">
            <svg xmlns="http://www.w3.org/2000/svg" style="color: #1c071e;" width="32" height="32" fill="currentColor"
                class="bi bi-arrow-left-short" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5" />
            </svg>
        </a>
    </div>

    <h2>Envía plata</h2>

    <!-- Campo Celular -->
    <div class="input-grupo" id="grupoCel">
        <label for="cel">Cel</label>
        <input id="cel" type="tel" maxlength="10" inputmode="numeric" oninput="validarCelular()" />
        <i class="bi bi-person-plus input-icono-derecha" onclick="abrirModalContacto()"></i>

    </div>

    <div class="nota">Revisa bien el número para enviarle a la persona correcta</div>

    <!-- Campo Monto -->
    <div class="input-grupo" id="grupoMonto">
        <label for="monto">¿Cuánto?</label>
        <input id="monto" type="tel" inputmode="numeric" oninput="checkCampos()" />
    </div>

    <!-- Campo Mensaje -->
    <div class="input-grupo" id="grupoMensaje">
        <label for="mensaje">Mensaje</label>
        <textarea id="mensaje" rows="3" oninput="checkCampos()"></textarea>
    </div>

    <!-- Sección de origen -->
    <div class="seccion">
        <div class="seccion-titulo">Escoge de donde saldrá la plata</div>
        <div class="origen">
            <div class="origen-izq">
                <div class="origen-icono">
                    <img src="./ico/image.png" alt="icono" />
                </div>
                <div>Disponible</div>
            </div>
            <i class="bi bi-chevron-right"></i>
        </div>
    </div>

    <!-- Botón -->
    <button id="btnSigue" class="btn-sigue" disabled>Sigue</button>

    <!-- ... todo el código anterior igual hasta el <script> -->
    <script>
        const campos = ['cel', 'monto'];

        // Formatea el monto como moneda COP
        function formatearMoneda(valor) {
            valor = valor.replace(/\D/g, ''); // Quita todo lo que no es número
            if (valor === '') return '';
            return '$ ' + Number(valor).toLocaleString('es-CO');
        }

        // Validación general
        function checkCampos() {
            let todosLlenos = true;

            // Campo CEL
            const cel = document.getElementById('cel');
            const grupoCel = document.getElementById('grupoCel');
            const celValor = cel.value.trim();
            if (celValor !== '') {
                grupoCel.classList.add('activo');  // Activa label si hay algo
            } else {
                grupoCel.classList.remove('activo');
                todosLlenos = false;
            }

            const celValido = /^\d{10}$/.test(celValor); // Validar si son 10 dígitos

            if (!celValido) {
                todosLlenos = false;
            }

            // Campo MONTO
            const monto = document.getElementById('monto');
            const grupoMonto = document.getElementById('grupoMonto');
            const montoRaw = monto.value.replace(/\D/g, '');
            if (montoRaw !== '') {
                grupoMonto.classList.add('activo');
            } else {
                grupoMonto.classList.remove('activo');
                todosLlenos = false;
            }

            // Campo MENSAJE
            const mensaje = document.getElementById('mensaje');
            const grupoMensaje = document.getElementById('grupoMensaje');
            if (mensaje.value.trim() !== '') {
                grupoMensaje.classList.add('activo');
            } else {
                grupoMensaje.classList.remove('activo');
            }

            document.getElementById('btnSigue').disabled = !todosLlenos;
        }


        // Formateo automático del campo monto
        const inputMonto = document.getElementById('monto');
        inputMonto.addEventListener('input', (e) => {
            const caret = e.target.selectionStart;
            const valorSinFormato = e.target.value.replace(/\D/g, '');
            e.target.value = formatearMoneda(valorSinFormato);
            checkCampos();
        });


        function validarCelular() {
            const cel = document.getElementById('cel');
            const grupoCel = document.getElementById('grupoCel');
            let valor = cel.value.replace(/\D/g, ''); // elimina letras y símbolos
            if (valor.length > 10) valor = valor.slice(0, 10); // máximo 10

            cel.value = valor;

            if (valor !== '') {
                grupoCel.classList.add('activo');
            } else {
                grupoCel.classList.remove('activo');
            }

            checkCampos(); // seguir validando todo
        }

        function checkCampos() {
            let todosLlenos = true;

            const cel = document.getElementById('cel');
            const celValido = /^\d{10}$/.test(cel.value);
            if (!celValido) todosLlenos = false;

            const monto = document.getElementById('monto');
            const grupoMonto = document.getElementById('grupoMonto');
            const montoRaw = monto.value.replace(/\D/g, '');
            if (montoRaw !== '') {
                grupoMonto.classList.add('activo');
            } else {
                grupoMonto.classList.remove('activo');
                todosLlenos = false;
            }

            const mensaje = document.getElementById('mensaje');
            const grupoMensaje = document.getElementById('grupoMensaje');
            if (mensaje.value.trim() !== '') {
                grupoMensaje.classList.add('activo');
            } else {
                grupoMensaje.classList.remove('activo');
            }

            document.getElementById('btnSigue').disabled = !todosLlenos;
        }
        // Validación también cuando se escribe en celular
        document.getElementById('cel').addEventListener('input', checkCampos);
        document.getElementById('mensaje').addEventListener('input', checkCampos);


        document.getElementById('btnSigue').addEventListener('click', function () {
            const cel = document.getElementById('cel').value;
            const monto = document.getElementById('monto').value;
            const modal = document.getElementById('modalConfirmacion');

            const datos = obtenerContactoDesdeLocalStorage(cel);

            const nombreEnmascarado = datos.enmascarado;
            const nombreReal = datos.real;

            document.getElementById('nombrePersona').textContent = nombreEnmascarado;
            document.getElementById('celModal').textContent = cel.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3');
            document.getElementById('montoModal').textContent = monto;

            // Guarda nombre real en variable global temporal
            window.nombreRealParaComprobante = nombreReal;

            modal.style.display = 'flex';
        });



        function cerrarModal() {
            document.getElementById('modalConfirmacion').style.display = 'none';
        }
        // Confirmacion de pago
                function confirmarEnvio() {
                    const nombreReal = window.nombreRealParaComprobante || 'Usuario Desconocido';
                    const monto = document.getElementById('montoModal').textContent;
                    const numero = document.getElementById('celModal').textContent;
                    // Guardar en localStorage
                    localStorage.setItem('Usuario', nombreReal);
                    localStorage.setItem('Numero', numero);
                    localStorage.setItem('Monto', monto);
                    setTimeout(() => {
                        const url = `comprobante.html?nombre=${encodeURIComponent(nombreReal)}&monto=${encodeURIComponent(monto)}&numero=${encodeURIComponent(numero)}`;
                        window.location.href = url;
                    }, 1000);
                }



        function obtenerContactoDesdeLocalStorage(numero) {
            const datos = JSON.parse(localStorage.getItem("contactosGuardados") || "{}");
            return datos[numero] || { enmascarado: 'Usu*** Desconoc***', real: 'Usuario Desconocido' };
        }

        function guardarContacto(numero, enmascarado, real) {
            const datos = JSON.parse(localStorage.getItem("contactosGuardados") || "{}");
            datos[numero] = { enmascarado, real };
            localStorage.setItem("contactosGuardados", JSON.stringify(datos));
        }

    </script>




    <script>
        function abrirModalContacto() {
            document.getElementById('modalNuevoContacto').style.display = 'flex';
        }
        function cerrarModalContacto() {
            document.getElementById('modalNuevoContacto').style.display = 'none';
        }
        function confirmarNuevoContacto() {
            const numero = document.getElementById('nuevoCel').value.trim();
            const real = document.getElementById('nuevoNombre').value.trim();
            const enmascarado = document.getElementById('nuevoEnmascarado').value.trim();

            if (!/^\d{10}$/.test(numero) || !real || !enmascarado) {
                alert("Por favor completa todos los campos correctamente.");
                return;
            }

            guardarContacto(numero, enmascarado, real);
            cerrarModalContacto();
            alert("Contacto guardado.");
        }


        function guardarContactosPorDefecto() {
            const contactosPorDefecto = {
                '3147645793': { enmascarado: 'Vic*** Paj***', real: 'Victor Pajaro' },
                '3243037899': { enmascarado: 'Dei*** Mor***', real: 'Deiby Moreno' },
                '3201234567': { enmascarado: 'Ana*** Lop***', real: 'Ana López' },
                '3002951566': { enmascarado: 'May***** Her***', real: 'Mayerlis Herazo' },
                '3006276801': { enmascarado: 'Ron** Mal******', real: 'Ronal Rafael Maldonado' },
                '3219519248': { enmascarado: 'Ann*** Rhe****', real: 'Annit Rhenals' },
                '3023657211': { enmascarado: 'Lia**** Alv****', real: 'Lianith Alvarez' },
                '3145549830': { enmascarado: 'Dei** Nar****', real: 'Deisy Naranjo' }
            };

            let guardados = JSON.parse(localStorage.getItem("contactosGuardados") || "{}");

            // Solo agrega si aún no están guardados
            for (let numero in contactosPorDefecto) {
                if (!guardados[numero]) {
                    guardados[numero] = contactosPorDefecto[numero];
                }
            }

            localStorage.setItem("contactosGuardados", JSON.stringify(guardados));
        }

        // Llamar la función al cargar la página
        // guardarContactosPorDefecto();
    </script>
</body>

</html>
